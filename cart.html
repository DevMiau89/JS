<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>First Script</title>
    // Odniesienie do skryptu w internecie
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
    <h1>Shopping Cart</h1>

    <div>
        <ul>
            <li><a class="add-to-cart" href="#" data-name="Apple" data-price="1.22">"Apple $1.22"</a></li>
            <li><a class="add-to-cart" href="#" data-name="Banana" data-price="1.33">"Banana $1.33"</a></li>
            <li><a class="add-to-cart" href="#" data-name="Shoe" data-price="22.33">"Shoe $22.33"</a></li>
            <li><a class="add-to-cart" href="#" data-name="Frisbee" data-price="5.22">"Frisbee $5.22"</a></li>
        </ul>
        <button id="clear-cart">Clear Cart</button>
    </div>

    <div>
        <ul id="show-cart">
            <!-- -->
        </ul>
        <div >Total Cart: $<span id="total-cart"></span></div>
    </div>

    <script>
        
        $(".add-to-cart").click(function(event){
            event.preventDefault();
            var name = $(this).attr("data-name");
            var price = Number($(this).attr("data-price"));
            shoppingCart.addItemToCart(name, price, 1);
            shoppingCart.displayCart();
        });

        
        $("#clear-cart").click(function(event){
            shoppingCart.clearCart();                       
            shoppingCart.displayCart();                   
        });
        
        
        $("#show-cart").on("click", ".delete-item", function(event) {
            var name = $(this).attr("data-name");
            shoppingCart.removeItemFromCartAll(name);
            shoppingCart.displayCart();
        });
        
        $("#show-cart").on("click", ".subtract-item", function(event){
            var name = $(this).attr("data-name");
            shoppingCart.removeItemFromCart(name);
            shoppingCart.displayCart();
        });
        
        $("#show-cart").on("click", ".plus-item", function(event){
           var name = $(this).attr("data-name");
           shoppingCart.addItemToCart(name, 0, 1);    
           shoppingCart.displayCart();    
        });
        
            
            
        //***************************************
        // Shopping Cart functions
            
            
        
        var shoppingCart = {};
            
        shoppingCart.cart = [];

        shoppingCart.Item = function(name, price, count){
            this.name = name;
            this.price = price;
            this.count = count;
        }
        
        shoppingCart.displayCart = function() {
            var cartArray = shoppingCart.listCart();
            var output = "";
            
            for (var i in cartArray) {
                output += "<li>"
                          + cartArray[i].name 
                          + " " 
                          + cartArray[i].count 
                          + "x" + cartArray[i].price  
                          + " = " + cartArray[i].total
                          + " <button class='plus-item' data-name='"
                          + cartArray[i].name+"'>+</button> "   
                          + " <button class='subtract-item' data-name= '"
                          + cartArray[i].name+"'>-</button> "    
                          + " <button class='delete-item' data-name='"
                          + cartArray[i].name + "'>X</button> "    
                          + "</li>";
            }
            
            $("#show-cart").html(output);
            $('#total-cart').html( shoppingCart.totalCart() );
        }


        shoppingCart.addItemToCart = function(name, price, count){
            for (var i in shoppingCart.cart) {
                if (shoppingCart.cart[i].name === name) {
                    shoppingCart.cart[i].count += count;
                    shoppingCart.saveCart();
                    return;
                }
            }
            var item = new shoppingCart.Item(name, price, count);
            shoppingCart.cart.push(item);
            shoppingCart.saveCart();
        }
        
         

        shoppingCart.removeItemFromCart = function(name) { // removes one item
            for (var i in shoppingCart.cart) {
                if (shoppingCart.cart[i].name === name) {
                    shoppingCart.cart[i].count --;
                    if (shoppingCart.cart[i].count === 0) {
                        shoppingCart.cart.splice( i, 1);
                    }
                    return;
                }
            }
            shoppingCart.saveCart();
        }

        shoppingCart.removeItemFromCartAll = function(name) {  // removes all item name
            for( var i in shoppingCart.cart ) {
                if(shoppingCart.cart[i].name === name) {
                    shoppingCart.cart.splice(i, 1);
                    return;
                }
            }
            shoppingCart.saveCart();
        } 

        shoppingCart.clearCart = function() {
            shoppingCart.cart = [];
            shoppingCart.saveCart();
        }

        shoppingCart.countCart = function() {   //-> return total count
            var totalCount = 0;
            for (var i in shoppingCart.cart) {
                totalCount += shoppingCart.cart[i].count;
            }

            return totalCount;
        }


        shoppingCart.totalCart = function() { //-> return total cost
            var totalCost = 0;
            for (var i in shoppingCart.cart) {
                totalCost += shoppingCart.cart[i].price  * shoppingCart.cart[i].count;
            }
            return totalCost.toFixed(2);
        }

        shoppingCart.listCart = function(){  //-> array of Items
            var cartCopy = [];
            for (var i in shoppingCart.cart) {
                var item = shoppingCart.cart[i];
                var itemCopy = {};
                for (var p in item) {
                    itemCopy[p] = item[p];
                }
                itemCopy.total = (item.price * item.count).toFixed(2);
                cartCopy.push(itemCopy);
            }
            return cartCopy;
        }

        
        shoppingCart.saveCart = function() {
            localStorage.setItem("shoppingCart", JSON.stringify(cart));
        }

        shoppingCart.loadCart = function() {
            cart = JSON.parse(localStorage.getItem("shoppingCart"));
        }

        shoppingCart.loadCart();
        shoppingCart.displayCart();


    </script>
</body>
</html>
